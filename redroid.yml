# Redroid 15 on Ubuntu 24.04 LXC
image:
  distribution: ubuntu
  release: 24.04
  architecture: amd64

packages:
  - linux-modules-extra-$(uname -r)
  - lxc-utils
  - skopeo
  - umoci
  - jq

files:
  - path: /usr/share/lxc/templates/lxc-oci
    content: |
      set -u

actions:
  - trigger: post-files
    action: |-
      mkdir -p $HOME/data-redroid15
      lxc-create -n redroid15 -t oci -- -u docker://docker.io/redroid/redroid:15.0.0-latest
      sed -i '/lxc.include/d' /var/lib/lxc/redroid15/config
      echo -e "lxc.init.cmd=/init androidboot.hardware=redroid androidboot.redroid_gpu_mode=guest
      lxc.apparmor.profile=unconfined
      lxc.autodev=1
      lxc.autodev.tmpfs.size=25000000
      lxc.mount.entry=$HOME/data-redroid15 data none bind 0 0" >> /var/lib/lxc/redroid15/config
      rm -f /var/lib/lxc/redroid15/rootfs/vendor/bin/ipconfigstore
      systemctl start lxc-net